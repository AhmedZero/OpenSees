libcommon: $(incdir)/mumps_int_def.h
	$(MAKE) $(libdir)/libmumps_common$(PLAT)$(LIBEXT)

d: $(incdir)/mumps_int_def.h libcommon
	$(MAKE) ARITH=d $(libdir)/libdmumps$(PLAT)$(LIBEXT)

OBJS_COMMON_MOD = \
        ana_omp_m.F\
        ana_blk_m.F\
        ana_orderings_wrappers_m.F\
        double_linked_list.o\
        fac_asm_build_sort_index_ELT_m.o\
        fac_asm_build_sort_index_m.o\
        fac_descband_data_m.o\
        fac_future_niv2_mod.o\
        fac_ibct_data_m.o\
        fac_maprow_data_m.o\
        front_data_mgt_m.o\
        lr_common.o \
        mumps_comm_ibcast.o\
        mumps_l0_omp_m.o\
        mumps_memory_mod.o\
        mumps_mpitoomp_m.o\
        mumps_ooc_common.o\
        mumps_static_mapping.o\
        omp_tps_common_m.o


OBJS_COMMON_OTHER = \
        ana_blk.F\
        ana_orderings.F\
        ana_set_ordering.F\
        ana_AMDMF.F\
        bcast_errors.o\
        estim_flops.o\
        mumps_type_size.o \
        mumps_type2_blocking.o \
        mumps_version.o \
        mumps_print_defined.o \
        mumps_common.o\
        mumps_pord.o\
        mumps_metis.o\
        mumps_metis64.o\
        mumps_metis_int.o\
        mumps_scotch.o\
        mumps_scotch64.o\
        mumps_scotch_int.o\
        mumps_size.o\
        mumps_io.o\
        mumps_io_basic.o\
        mumps_io_thread.o\
        mumps_io_err.o\
        mumps_numa.o \
        mumps_thread.o \
        mumps_save_restore_C.o \
        mumps_config_file_C.o \
        mumps_thread_affinity.o \
        mumps_register_thread.o \
        tools_common.o \
        sol_common.o

OBJS_MOD =   \
        dana_aux.F \
        dana_aux_par.F \
        dana_lr.F\
        dfac_asm_master_ELT_m.o\
        dfac_asm_master_m.o\
        dfac_front_aux.o\
        dfac_front_LU_type1.o\
        dfac_front_LU_type2.o\
        dfac_front_LDLT_type1.o\
        dfac_front_LDLT_type2.o\
        dfac_front_type2_aux.o\
        dfac_sispointers_m.o\
        dfac_lr.o\
        dfac_mem_dynamic.o\
        dfac_omp_m.o\
        dfac_par_m.o\
        dfac_sol_l0omp_m.o\
        dlr_core.o\
        dlr_stats.o\
        dlr_type.o\
        dmumps_comm_buffer.o\
        dmumps_config_file.o\
        dmumps_load.o\
        dmumps_lr_data_m.o\
        dmumps_ooc_buffer.o\
        dmumps_ooc.o\
        dmumps_sol_es.o\
        dmumps_save_restore.o\
        dmumps_save_restore_files.o\
        dmumps_struc_def.o\
        domp_tps_m.o\
        dsol_lr.o\
        dsol_omp_m.o\
        dstatic_ptr_m.o

OBJS_OTHER = \
        dini_driver.o\
        dana_driver.F\
        dfac_driver.o\
        dsol_driver.o\
        dsol_distrhs.o\
        dend_driver.o\
        dana_aux_ELT.F\
        dana_dist_m.F\
        dana_LDLT_preprocess.F\
        dana_reordertree.F\
        darrowheads.o\
        dbcast_int.o\
        dfac_asm_ELT.o\
        dfac_asm.o\
        dfac_b.o\
        dfac_distrib_distentry.o\
        dfac_distrib_ELT.o\
        dfac_lastrtnelind.o\
        dfac_mem_alloc_cb.o\
        dfac_mem_compress_cb.o\
        dfac_mem_free_block_cb.o\
        dfac_mem_stack_aux.o\
        dfac_mem_stack.o\
        dfac_process_band.o\
        dfac_process_blfac_slave.o\
        dfac_process_blocfacto_LDLT.o\
        dfac_process_blocfacto.o\
        dfac_process_bf.o\
        dfac_process_end_facto_slave.o\
        dfac_process_contrib_type1.o\
        dfac_process_contrib_type2.o\
        dfac_process_contrib_type3.o\
        dfac_process_maprow.o\
        dfac_process_master2.o\
        dfac_process_message.o\
        dfac_process_root2slave.o\
        dfac_process_root2son.o\
        dfac_process_rtnelind.o\
        dfac_root_parallel.o\
        dfac_scalings.o\
        dfac_determinant.o\
        dfac_scalings_simScaleAbs.o\
        dfac_scalings_simScale_util.o\
        dfac_sol_pool.o\
        dfac_type3_symmetrize.o\
        dini_defaults.o\
        dmumps_c.o\
        dmumps_driver.o\
        dmumps_f77.o\
        dmumps_gpu.o\
        dmumps_iXamax.o\
        dana_mtrans.F\
        dooc_panel_piv.o\
        drank_revealing.o\
        dsol_aux.o\
        dsol_bwd_aux.o\
        dsol_bwd.o\
        dsol_c.o\
        dsol_fwd_aux.o\
        dsol_fwd.o\
        dsol_matvec.o\
        dsol_root_parallel.o\
        dtools.o\
        dtype3_root.o

$(libdir)/libmumps_common$(PLAT)$(LIBEXT):      $(OBJS_COMMON_MOD) $(OBJS_COMMON_OTHER)
	$(AR)$@ $?
	$(RANLIB) $@

$(libdir)/libdmumps$(PLAT)$(LIBEXT):    $(OBJS_MOD) $(OBJS_OTHER)
	$(AR)$@ $?
	$(RANLIB) $@

# Dependencies between modules:
# i) arithmetic-dependent modules:
dana_aux.o:              dmumps_struc_def.o \
                                mumps_static_mapping.o \
                                ana_orderings_wrappers_m.o \
                                ana_blk_m.o
dana_aux_par.o:          dmumps_struc_def.o \
                                mumps_memory_mod.o \
                                ana_orderings_wrappers_m.o
dana_lr.o:                dlr_core.o\
                                dlr_stats.o\
                                lr_common.o\
                                ana_orderings_wrappers_m.o \
                                ana_blk_m.o 
dfac_asm_master_ELT_m.o: omp_tps_common_m.o \
                                fac_ibct_data_m.o \
                                fac_asm_build_sort_index_ELT_m.o \
                                lr_common.o \
                                dfac_mem_dynamic.o \
                                dlr_core.o \
                                dana_lr.o \
                                dmumps_lr_data_m.o \
                                dmumps_struc_def.o \
                                domp_tps_m.o \
                                dmumps_comm_buffer.o \
                                dmumps_load.o 

dfac_asm_master_m.o:     omp_tps_common_m.o \
                                fac_ibct_data_m.o \
                                fac_asm_build_sort_index_m.o \
                                lr_common.o \
                                dfac_mem_dynamic.o \
                                dlr_core.o \
                                dana_lr.o \
                                dmumps_lr_data_m.o \
                                dmumps_struc_def.o \
                                domp_tps_m.o \
                                dmumps_comm_buffer.o \
                                dmumps_load.o 

dfac_front_aux.o:        dlr_type.o\
                                dlr_stats.o\
                                dmumps_comm_buffer.o\
                                dmumps_load.o\
                                dmumps_ooc.o\
                                mumps_ooc_common.o\
                                mumps_l0_omp_m.o

dfac_front_LU_type1.o   : dfac_front_aux.o\
                                 dmumps_ooc.o\
                                 dfac_lr.o\
                                 dlr_type.o\
                                 dlr_stats.o\
                                 dana_lr.o\
                                 dmumps_lr_data_m.o\
                                 mumps_l0_omp_m.o

dfac_front_LU_type2.o   : dfac_front_aux.o\
                                 dfac_front_type2_aux.o\
                                 dmumps_ooc.o\
                                 dmumps_comm_buffer.o\
                                 mumps_comm_ibcast.o\
                                 dfac_lr.o\
                                 dlr_core.o\
                                 dlr_type.o\
                                 dlr_stats.o\
                                 dana_lr.o\
                                 dmumps_lr_data_m.o\
                                 dmumps_struc_def.o

dfac_front_LDLT_type1.o : dfac_front_aux.o\
                                 dmumps_ooc.o\
                                 dfac_lr.o\
                                 dlr_type.o\
                                 dlr_stats.o\
                                 dana_lr.o\
                                 dmumps_lr_data_m.o\
                                 mumps_l0_omp_m.o

dfac_front_LDLT_type2.o : dfac_front_aux.o\
                                 dfac_front_type2_aux.o\
                                 dmumps_ooc.o\
                                 dmumps_comm_buffer.o\
                                 dmumps_load.o\
                                 dfac_lr.o\
                                 dlr_type.o\
                                 dlr_stats.o\
                                 dana_lr.o\
                                 dmumps_lr_data_m.o\
                                 dmumps_struc_def.o

dfac_front_type2_aux.o : mumps_ooc_common.o\
                                dfac_front_aux.o\
                                dlr_type.o\
                                dmumps_struc_def.o\
                                dmumps_comm_buffer.o\
                                dmumps_load.o\
                                mumps_comm_ibcast.o\
                                fac_ibct_data_m.o

dfac_lr.o:               dlr_core.o\
                                dlr_type.o\
                                dmumps_lr_data_m.o\
                                dlr_stats.o

dfac_mem_dynamic.o:      dmumps_load.o\
                                dstatic_ptr_m.o

dfac_omp_m.o:            dfac_asm_master_m.o\
                                dfac_asm_master_ELT_m.o\
                                dfac_front_LU_type1.o\
                                dfac_front_LDLT_type1.o\
                                dmumps_load.o\
                                domp_tps_m.o\
                                dlr_stats.o\
                                dmumps_struc_def.o\
                                omp_tps_common_m.o\
                                mumps_l0_omp_m.o

dfac_sol_l0omp_m.o:      dmumps_struc_def.o

dfac_omp_m.o:            dmumps_struc_def.o \
                                dfac_mem_dynamic.o\
                                domp_tps_m.o\
                                omp_tps_common_m.o

dfac_par_m.o:            dmumps_load.o\
                                dmumps_ooc.o\
                                dfac_asm_master_m.o\
                                dfac_asm_master_ELT_m.o\
                                domp_tps_m.o\
                                dfac_front_LU_type1.o\
                                dfac_front_LU_type2.o\
                                dfac_front_LDLT_type1.o\
                                dfac_front_LDLT_type2.o\
                                dfac_mem_dynamic.o\
                                dmumps_struc_def.o\
                                dlr_stats.o\
                                omp_tps_common_m.o\
                                mumps_l0_omp_m.o

dlr_core.o:              dlr_type.o\
                                dmumps_lr_data_m.o\
                                dlr_stats.o\
                                lr_common.o

dlr_stats.o:             dlr_type.o \
                                dmumps_struc_def.o

dmumps_comm_buffer.o:    mumps_comm_ibcast.o \
                                dlr_type.o \
                                dlr_core.o \
                                dmumps_lr_data_m.o \
                                fac_ibct_data_m.o

dmumps_config_file.o:    dmumps_struc_def.o

dmumps_load.o:           dmumps_comm_buffer.o \
                                dmumps_struc_def.o \
                                fac_future_niv2_mod.o

dmumps_lr_data_m.o:      dlr_type.o\
                                front_data_mgt_m.o

dmumps_ooc_buffer.o:     mumps_ooc_common.o

dmumps_ooc.o:            dmumps_struc_def.o \
                                dmumps_ooc_buffer.o \
                                mumps_ooc_common.o

dmumps_sol_es.o:         dlr_type.o \
                                dmumps_lr_data_m.o

dmumps_save_restore.o:   dmumps_struc_def.o \
                                dmumps_save_restore_files.o \
                                dmumps_lr_data_m.o \
                                dmumps_ooc.o \
                                dfac_sol_l0omp_m.o \
                                front_data_mgt_m.o

dmumps_save_restore_files.o : dmumps_struc_def.o

dsol_lr.o:               dlr_type.o\
                                dlr_stats.o\
                                dmumps_lr_data_m.o

dsol_omp_m.o:            dmumps_struc_def.o





# Dependencies between modules:
# ii) arithmetic-independent modules:

ana_omp_m.o:                     double_linked_list.o
fac_asm_build_sort_index_ELT_m.o:omp_tps_common_m.o
fac_asm_build_sort_index_m.o:    omp_tps_common_m.o
fac_descband_data_m.o:           front_data_mgt_m.o
fac_ibct_data_m.o:               front_data_mgt_m.o
fac_maprow_data_m.o:             front_data_mgt_m.o
mumps_comm_ibcast.o:             fac_future_niv2_mod.o
mumps_static_mapping.o:          lr_common.o


